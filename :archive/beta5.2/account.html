  <!DOCTYPE html>
  <html lang="it">
  <head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Account | The Fork</title>
  <meta name="description" content="">
  <meta name="author" content="">
  <link rel="icon" href="../../favicon.ico">

<!-- //////////////// CSS -->

  <link href="https://fonts.googleapis.com/css?family=Slabo+27px" rel="stylesheet">
  <link href="css/bootstrap.css" rel="stylesheet">
  <link href="css/bootstrap-material-design.css" rel="stylesheet">

  <script src="js/ristoranti.json"></script>
  <script src="js/vendor/modernizr-2.8.3-respond-1.4.2.min.js"></script>

  <style>
    body {
      padding-top: 80px;
      padding-bottom: 60px;
    }
  </style>

   <script type="text/javascript">

///////////////////////// STAMPA DATI UTENTE

function stampaDatiUtente(){

  var u = JSON.parse(localStorage.utenti);
  var nextpos = u.length;

  ////////////// inizio parte da stampare
  var s = new String("");
  for (i=0;i<nextpos;i++){
    if (u[i].l==1) {
      s+="<strong>nome e cognome</strong>: "+u[i].nc+"<br/>";
      s+="<button type='submit' class='btn btn-raised btn-success' onclick='modificaNomecognome();'>Modifica nome e cognome</button><br/>";
      s+="<strong>password</strong>: ******<br/>";
      // s+="<strong>password</strong>: "+u[i].p+"<br/>";
      s+="<button type='submit' class='btn btn-raised btn-success' onclick='modificaPassword();'>Modifica password</button>";
    } // if
  } // for
  ///////////// fine parte da stampare

  document.getElementById("vistaDatiUtente").innerHTML = s;

  return true;
}

///////////////////////// STAMPA PRENOTAZIONI UTENTE

function stampaPrenotazioniUtente(){

  var u = JSON.parse(localStorage.utenti);
  var nextpos = u.length;

  ////////////// inizio parte da stampare
  var s = new String("");
  
  for (i=0;i<nextpos;i++){ // ciclo per trovare utente loggato

    if (u[i].l==1 && u[i].prenotazione.length!=0) { // controllo se utente loggato

      for (j=0; j<u[i].prenotazione.length; j++) { // ciclo per riuscire a stampre più prenotazioni

        // alert("utente loggato trovato");

        s+="<strong>nome ristorante</strong>: "+u[i].prenotazione[j].r+"<br/>";
        s+="<strong>giorno</strong>: ";

          if (u[i].prenotazione[j].g == 0)
              s+="lunedì";
           else if (u[i].prenotazione[j].g == 1)
              s+="martedì";
           else if (u[i].prenotazione[j].g == 2)
              s+="mercoledì";
           else if (u[i].prenotazione[j].g == 3)
              s+="giovedì";
           else if (u[i].prenotazione[j].g == 4)
              s+="venerdì";
           else if (u[i].prenotazione[j].g == 5)
              s+="sabato";
           else if (u[i].prenotazione[j].g == 6)
              s+="domenica";

         s+="<br/>";

         s+="<strong>orario</strong>: ";

         if (u[i].prenotazione[j].o == 0)
            s+="19-21";
         else
            s+="21+";

         s+="<br/>";

         s+="<strong>posti</strong>: "+u[i].prenotazione[j].t;

         s+="<br/><br/>";

         // s+="<button type='submit' class='btn btn-raised btn-success' onclick='cancellaPrenotazione(j);'>Cancella prenotazione</button>";

      } // for

      s+="<button onclick='prenotaOra();' class='btn btn-raised btn-success'>prenota ancora</button>";

      } else {

      s+="nessuna prenotazione presente<br/>";

      s+="<button onclick='prenotaOra();' class='btn btn-raised btn-success'>prenota ora</button>";

    } // else

  } // for

  ///////////// fine parte da stampare

  document.getElementById("vistaPrenotazioniUtente").innerHTML = s;

  return true;

}

///////////////////////// PRENOTA ORA

function prenotaOra(){
  window.location.href = "index.html";
}

///////////////////////// MODIFICA PASSWORD

function modificaPassword(){

  var u = JSON.parse(localStorage.utenti);
  var nextpos = u.length;
  
  for (i=0;i<nextpos;i++)
    if (u[i].l==1)
      window.location.href = "modificapassword.html?" + i;

}

///////////////////////// MODIFICA NOME E COGNOME

function modificaNomecognome(){

  var u = JSON.parse(localStorage.utenti);
  var nextpos = u.length;
  
  for (i=0;i<nextpos;i++)
    if (u[i].l==1)
      window.location.href = "modificanomecognome.html?" + i;

}

///////////////////////// CANCELLA PRENOTAZIONE da sistemare

function cancellaPrenotazione(k){

  var u = JSON.parse(localStorage.utenti);
  var v = JSON.parse(localStorage.ristoranti);

  var nextposu = u.length;
  var nextposv = v.length;

  for (i=0;i<nextposu;i++){
    if (u[i].l==1) {

    var a = parseInt(u[i].t);
    v[0].prenotazione[u[i].prenotazione[0].g].tavolo[u[i].prenotazione[0].o].posti += a;

    // u[i].prenotazione[0]="";

    // localStorage.removeItem(u[i].prenotazione[0].r);

    /*
    u[i].prenotazione[0].r="";
    u[i].prenotazione[0].g="";
    u[i].prenotazione[0].o="";
    u[i].prenotazione[0].t=0; */

    localStorage.ristoranti = JSON.stringify(v);
    localStorage.utenti = JSON.stringify(u);

    alert("cancellazione prenotazione avvenuta con successo");
    location.reload();

    return true;

    } // if
  } // for

  alert("errore, riprova");
  return false;

}

///////////////////////// ESCI ACCOUNT

function esciAccount(){
         
  var u = JSON.parse(localStorage.utenti);
  var nextpos = u.length;

  for (i=0;i<nextpos;i++){

    if (u[i].l==1) {

      u[i].l=0;
      localStorage.utenti = JSON.stringify(u);
      alert("uscita avvenuta con successo");
      window.location.href = "entra.html";
      return true;

    } // if
  } // for

  alert("errore, riprova");
  return false;

}

///////////////////////// CANCELLA ACCOUNT

      function cancellaAccount(){

      	// https://stackoverflow.com/questions/28362404/how-to-delete-a-specific-item-object-in-localstorage

        // 1. Parse the string in localStorage to JSON

        var items = JSON.parse(localStorage.utenti);
        // var items = JSON.parse(localStorage.getItem("utenti"));

        // cerco utente loggato
        for(var i=0; i<items.length;i++)
        	if(items[i].l==1)
        		var nomeutente = new String(items[i].nc);

        // alert(nomeutente);

        // 2. Remove the item you don't want (with slice() ) 

        for (var i=0; i<items.length; i++) {
        	// alert("for");
        	// alert(items.length);

		    // var items = JSON.parse(items[i]);

		    if (items[i].nc == nomeutente) {
		    	// alert("if");
		    // if (items.itemId == 0) {
		        items.splice(i, 1);
		    }
		}

		// 3. Make the JSON to string

		localStorage.utenti = JSON.stringify(items);
		// item = JSON.stringify(items);

		// 4. Re-set it in the localStorage
		
		// localStorage.setItem("utenti", items);

		alert("cancellazione account avvenuta con successo");
		window.location.href = "entra.html";
		return false;

      }


   </script>

</head>

<body onload="stampaDatiUtente(); stampaPrenotazioniUtente(); checkPrenotazione();">

<!-- //////////////// NAVBAR -->

      <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">

        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
         <span class="glyphicon glyphicon-user"></span>
          </button>
          <a class="navbar-brand" href="index.html"> <span class="glyphicon glyphicon-cutlery"></span> The Fork</a>
        </div>

        <div id="navbar" class="navbar-collapse collapse">

        <button onclick="location.href='entra.html';" class="btn btn-raised btn-warning">account</button>

        </div><!--/.navbar-collapse -->       

      </div>
    </nav>

<!-- //////////////// CONTENT -->

<div class="container-fluid">
<h1>Account utente</h1>

<h2>Dati utente</h2>

<div id="vistaDatiUtente"></div>

<h2>Le tue prenotazioni</h2>

<div id="vistaPrenotazioniUtente"></div>

<h2>Avanzate</h2>
<button type='submit' class='btn btn-raised btn-success' onclick="esciAccount();">Esci dall'account</button>
<input type="submit" class="btn btn-raised btn-danger" value="Cancella Account" onclick="cancellaAccount();">

</div>

<!-- //////////////// JAVASCRIPT -->

   <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.js"></script>
   <script>window.jQuery || document.write('<script src="js/vendor/jquery-1.11.2.js"><\/script>')</script>
   <script src="js/vendor/bootstrap.min.js"></script>
   <script src="js/vendor/plugins.js"></script>

</body>

</html>