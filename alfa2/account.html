  <!DOCTYPE html>
  <html lang="it">
  <head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Account | The Fork</title>
  <meta name="description" content="">
  <meta name="author" content="">
  <link rel="icon" href="../../favicon.ico">

<!-- //////////////// CSS -->

  <link href="https://fonts.googleapis.com/css?family=Slabo+27px" rel="stylesheet">
  <link href="css/bootstrap.css" rel="stylesheet">
  <link href="css/bootstrap-material-design.css" rel="stylesheet">

  <script src="js/ristoranti.json"></script>
  <script src="js/vendor/modernizr-2.8.3-respond-1.4.2.min.js"></script>

  <style>
    body {
      padding-top: 80px;
      padding-bottom: 60px;
    }
  </style>

   <script type="text/javascript">

///////////////////////// RESET LOCAL STORAGE, serve solo per fare le prove

      function resetStorageUtenti(){
         localStorage.utenti="[]";
      }

///////////////////////// STAMPA LOCAL STORAGE, serve solo per fare le prove

      function stampaStorageTabella(){
         var u = JSON.parse(localStorage.utenti);
         var nextpos = u.length;

         ////////////// inizio parte da stampare
         var s = new String("<h3>localStorage:</h3>");
         s +="<table border=1><tr><th>login</th><th>nome e cognome</th><th>password</th><th>ristorante</th><th>orario</th><th>posti</th>";

         s+="</tr>";
         for (i=0;i<nextpos;i++){
            s += "<tr><td>"+u[i].l+"</td><td>"+u[i].nc+"</td><td>"+u[i].p+"</td><td>"+u[i].r+"</td><td>"+u[i].o+"</td><td>"+u[i].t+"</td><td>";
            s+="</td></tr>";
         }
         s += "</table>";
         ///////////// fine parte da stampare

         document.getElementById("vistaStorage").innerHTML = s;

         return true;
      }

///////////////////////// STAMPA DATI UTENTE

function checkPrenotazione(){

   var u = JSON.parse(localStorage.ristoranti);
   var nextpos = u.length;

   for (i=0;i<nextpos;i++) {
      if (u[i].p==1) {
         u[i].p=0;
         localStorage.ristoranti = JSON.stringify(u);
         window.location.href = "prenotazione.html";
      }
   }

}

///////////////////////// STAMPA DATI UTENTE

function stampaDatiUtente(){
         var u = JSON.parse(localStorage.utenti);
         var nextpos = u.length;

         ////////////// inizio parte da stampare
         var s = new String("");
         for (i=0;i<nextpos;i++){
            if (u[i].l==1) {
               s+="<strong>nome e cognome</strong>: "+u[i].nc+"<br/>";
               s+="<strong>password</strong>: "+u[i].p+"<br/>";
            }
         }
         ///////////// fine parte da stampare

         document.getElementById("vistaDatiUtente").innerHTML = s;

         return true;
      }

///////////////////////// STAMPA PRENOTAZIONI UTENTE

function stampaPrenotazioniUtente(){
   var u = JSON.parse(localStorage.utenti);
   var nextpos = u.length;

   ////////////// inizio parte da stampare
   var s = new String("");
   for (i=0;i<nextpos;i++){
      if (u[i].l==1 && u[i].r!="") {

         s+="<strong>nome ristorante</strong>: "+u[i].r+"<br/>";

         s+="<strong>giorno</strong>: ";

         if (u[i].g == 0)
            s+="lunedì";
         else if (u[i].g == 1)
            s+="martedì";
         else if (u[i].g == 2)
            s+="mercoledì";
         else if (u[i].g == 3)
            s+="giovedì";
         else if (u[i].g == 4)
            s+="venerdì";
         else if (u[i].g == 5)
            s+="sabato";
         else if (u[i].g == 6)
            s+="domenica";

         s+="<br/>";

         s+="<strong>orario</strong>: ";

         if (u[i].o == 0)
            s+="19-21";
         else
            s+="21+";

         s+="<br/>";

         s+="<strong>posti</strong>: "+u[i].t;

         s+="<br/>";

         s+="<button type='submit' class='btn btn-raised btn-success' onclick='cancellaPrenotazione();'>Cancella prenotazione</button>";

      } else {

         s="nessuna prenotazione presente, <a href='home.html'>prenota ora</a>";

      }
   }
   ///////////// fine parte da stampare

   document.getElementById("vistaPrenotazioniUtente").innerHTML = s;

   return true;

}

///////////////////////// CANCELLA PRENOTAZIONE

function cancellaPrenotazione(){

         var u = JSON.parse(localStorage.utenti);
         var v = JSON.parse(localStorage.ristoranti);

         var nextposu = u.length;
         var nextposv = v.length;

         for (i=0;i<nextposu;i++){
            if (u[i].l==1) {

               var a = parseInt(u[i].t);

               v[0].prenotazione[u[i].g].tavolo[u[i].o].posti += a;

               // alert("v[0].prenotazione[u[i].g].tavolo[u[i].o].posti"+v[0].prenotazione[u[i].g].tavolo[u[i].o].posti);

               u[i].r="";
               u[i].g="";
               u[i].o="";
               u[i].t=0;

               localStorage.ristoranti = JSON.stringify(v);
               localStorage.utenti = JSON.stringify(u);

               alert("cancellazione prenotazione avvenuta con successo");
               location.reload();
               return true;
            }  
         }

         alert("errore, riprova");
         return false;
}

///////////////////////// ESCI ACCOUNT

function esciAccount(){
         var u = JSON.parse(localStorage.utenti);
         var nextpos = u.length;

         for (i=0;i<nextpos;i++){
            if (u[i].l==1) {
               u[i].l=0;
               localStorage.utenti = JSON.stringify(u);
               alert("uscita avvenuta con successo");
               window.location.href = "entra.html";
               return true;
            }  
         }

         alert("errore, riprova");
         return false;
}

///////////////////////// CANCELLA ACCOUNT da sistemare

function cancellaAccount(){
         var u = JSON.parse(localStorage.utenti);
         var nextpos = u.length;

         for (i=0;i<nextpos;i++){
            if (u[i].l==1) {
               delete u[i]; // il valore nel vettore diventa "null" e non va bene
               localStorage.utenti = JSON.stringify(u);
               alert("cancellazione account avvenuta con successo");
               return true;
            }  
         }

         alert("errore, riprova");
         return false;
}


   </script>

</head>

<body onload="stampaDatiUtente(); stampaPrenotazioniUtente(); checkPrenotazione();">

<!-- //////////////// NAVBAR -->

      <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">

        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
         <span class="glyphicon glyphicon-user"></span>
          </button>
          <a class="navbar-brand" href="home.html"> <span class="glyphicon glyphicon-cutlery"></span> The Fork</a>
        </div>

        <div id="navbar" class="navbar-collapse collapse">

        <button onclick="location.href='entra.html';" class="btn btn-raised btn-warning">account</button>

        </div><!--/.navbar-collapse -->       

      </div>
    </nav>

<!-- //////////////// CONTENT -->

<div class="container-fluid">
<h1>Account utente</h1>

<h2>Dati utente</h2>

<div id="vistaDatiUtente"></div>

<h2>Prenotazioni</h2>

<div id="vistaPrenotazioniUtente"></div>

<h2>Avanzate</h2>
<button type='submit' class='btn btn-raised btn-success' onclick="esciAccount();">Esci dall'account</button>
<!-- <input type="button" value="Cancella Account" onclick="cancellaAccount();"> -->

</div>

<!-- 
<div class="container-fluid">
   <hr>

   <input type="button" value="Stampa Storage Tabella" onclick="stampaStorageTabella();">
   <input type="button" value="Reset Storage" onclick="resetStorageUtenti();">

   <div id="vistaStorage"></div>
</div> -->

<!-- //////////////// JAVASCRIPT -->

   <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.js"></script>
   <script>window.jQuery || document.write('<script src="js/vendor/jquery-1.11.2.js"><\/script>')</script>
   <script src="js/vendor/bootstrap.min.js"></script>
   <script src="js/vendor/plugins.js"></script>

</body>

</html>