<!DOCTYPE html>

<head>

   <meta charset="utf-8" />
   <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
   <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />

   <style type="text/css">
      body {
         padding-top: 5px;
         padding-bottom: 5px;
      }
   </style>

   <!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

   <script>

///////////////////////// INIZIALIZZAZIONE LOCAL STORAGE

      function inizializzaStorageUtenti(){
         if (typeof(localStorage.utenti) == "undefined") {
            localStorage.utenti="[]";
         }
      }

///////////////////////// CONTROLLA LOGIN

      function checkLogin(){

         var u = JSON.parse(localStorage.utenti);
         var nextpos = u.length;

         for (i=0;i<nextpos;i++)
            if (u[i].l==1)
               window.location.href = "account.html";

      }

///////////////////////// RESET LOCAL STORAGE, serve solo per fare le prove

      function resetStorageUtenti(){
         localStorage.utenti="[]";
      }

///////////////////////// STAMPA LOCAL STORAGE, serve solo per fare le prove

      function stampaStorageTabella(){
         var u = JSON.parse(localStorage.utenti);
         var nextpos = u.length;

         ////////////// inizio parte da stampare
         var s = new String("<h3>localStorage:</h3>");
         s +="<table border=1><tr><th>login</th><th>nome e cognome</th><th>password</th><th>ristorante</th><th>orario</th><th>posti</th>";

         s+="</tr>";
         for (i=0;i<nextpos;i++){
            s += "<tr><td>"+u[i].l+"</td><td>"+u[i].nc+"</td><td>"+u[i].p+"</td><td>"+u[i].r+"</td><td>"+u[i].o+"</td><td>"+u[i].t+"</td><td>";
            s+="</td></tr>";
         }
         s += "</table>";
         ///////////// fine parte da stampare

         document.getElementById("vistaStorage").innerHTML = s;

         return true;
      }

///////////////////////// SE UGUALI

      function uguali(u,o){
         if (u.nc==o.nc)
            return true;
         return false;
      }

      function uguali_psw(u,o){
         if ((u.nc==o.nc)&&(u.p==o.p))
            return true;
         return false;
      }

///////////////////////// REGISTRAZIONE UTENTE

      function registrazioneUtente() {

      var u = JSON.parse(localStorage.utenti);
      var nextpos = u.length;

      // dati inseriti
      var o = {
                  l:1, // quando si registra e' automaticamente loggato
                  nc:document.registrazione.nomecognome.value,
                  p:document.registrazione.password.value,
                  r:"",
                  o:"",
                  t:0
               };

      // controllo se l'utente e' gia' inserito
      for (i=0;i<nextpos;i++)
         if(uguali(u[i],o)) {
            alert("Utente gia' inserito!");
            return false;
      }

      alert("Dati inseriti correttamente :)");

      u[nextpos] = o; // metto i dati nell'ultima posizione
      localStorage.utenti = JSON.stringify(u);

      window.location.href = "account.html";

      return true;

      }

///////////////////////// LOGIN UTENTE

      function loginUtente() {

      var u = JSON.parse(localStorage.utenti);
      var nextpos = u.length;

      // dati inseriti
      var o = {
                  nc:document.login.nomecognome.value,
                  p:document.login.password.value
               };

      for (i=0;i<nextpos;i++) {

         // se i dati inseriti combaciano con un utente salvato nel local storage
         if(uguali_psw(u[i],o)) {

            u[i].l = 1; // imposto il login a 1 cosi' so che e' dentro
            localStorage.utenti = JSON.stringify(u); // trasformo e invio al local storage

            alert("login avvenuto con successo (login = "+u[i].l+")");

            window.location.href = "account.html";

            return true;

         }
      } // for

      alert("dati NON corretti");
      return false;

      }

   </script>

</head>

<body onload="inizializzaStorageUtenti(); checkLogin();">

<div class="container-fluid">
<div class="jumbotron"><h1>Entra</h1></div>
<div class="col-md-6">

   <h1>Registrazione utente</h1>

   <form action="" method="post" name="registrazione" onSubmit="return registrazioneUtente();"
   accept-charset="utf-8">

   <strong>nome e cognome</strong>
   <input type="text" name="nomecognome" size="30" minlength="4" maxlength="30" required>

   <br><br>

   <strong>password</strong> (da 6 a 12 caratteri)
   <input type="password" name="password" size="12" minlength="6" maxlength="12" required="">

   <br><br/>

   <input type="submit" value="Registrati">

   </form>

</div>

<div class="col-md-6">
   <h1>Login Utente</h1>

   <form action="" method="post" name="login" onSubmit="return loginUtente();"
   accept-charset="utf-8">

   <strong>nome e cognome</strong>
   <input type="text" name="nomecognome" size="30" maxlength="30" required="">

   <br><br>

   <strong>password</strong> (da 6 a 12 caratteri)
   <input type="password" name="password" size="12" minlength="6" maxlength="12" required="">

   <br><br/>

   <!-- <input type="submit" value="Entra">  -->
   <input type="submit" value="Entra"">
   
   </form>

   <div id="accountUtente"></div>

</div>

</div>

<div class="container-fluid">
   <hr>

   <input type="button" value="Stampa Storage Tabella" onclick="stampaStorageTabella();">
   <input type="button" value="Reset Storage" onclick="resetStorageUtenti();">

   <div id="vistaStorage"></div>
</div>

</body>

</html>