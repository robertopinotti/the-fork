  <!DOCTYPE html>
  <html lang="it">
  <head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Account | The Fork</title>
  <meta name="description" content="">
  <meta name="author" content="">
  <link rel="icon" href="../../favicon.ico">

<!-- //////////////// CSS -->

  <link href="https://fonts.googleapis.com/css?family=Slabo+27px" rel="stylesheet">
  <link href="css/bootstrap.css" rel="stylesheet">
  <link href="css/bootstrap-material-design.css" rel="stylesheet">

  <script src="js/ristoranti.json"></script>
  <script src="js/vendor/modernizr-2.8.3-respond-1.4.2.min.js"></script>

  <style>
    body {
      padding-top: 80px;
      padding-bottom: 60px;
    }
  </style>

   <script type="text/javascript">

///////////////////////// STAMPA DATI UTENTE

function stampaDatiUtente(){

  var u = JSON.parse(localStorage.utenti);
  var nextpos = u.length;

  ////////////// inizio parte da stampare
  var s = new String("");
  for (i=0;i<nextpos;i++){
    if (u[i].l==1) {
      s+="<strong>nome e cognome</strong>: "+u[i].nc+"<br/>";
      s+="<strong>password</strong>: "+u[i].p+"<br/>";
    } // if
  } // for
  ///////////// fine parte da stampare

  document.getElementById("vistaDatiUtente").innerHTML = s;

  return true;
}

///////////////////////// STAMPA PRENOTAZIONI UTENTE

function stampaPrenotazioniUtente(){

  var u = JSON.parse(localStorage.utenti); // vettore degli utenti
  var nextpos = u.length; // lunghezza vettore degli utenti

  ////////////// inizio parte da stampare
  var s = new String("");
  
  // ciclo per trovare utente loggato
  for (i=0;i<nextpos;i++){

    // controllo se utente loggato
    if (u[i].l==1 && /* u[i].prenotazione.length!=0 */ u[i].prenotazione!="") {

      for (j=0; j<u[i].prenotazione.length; j++) { // ciclo per riuscire a stampre più prenotazioni

        // alert("utente loggato trovato");

        s+="<strong>nome ristorante</strong>: "+u[i].prenotazione[j].r+"<br/>";
        s+="<strong>giorno</strong>: ";

          if (u[i].prenotazione[j].g == 0)
              s+="lunedì";
           else if (u[i].prenotazione[j].g == 1)
              s+="martedì";
           else if (u[i].prenotazione[j].g == 2)
              s+="mercoledì";
           else if (u[i].prenotazione[j].g == 3)
              s+="giovedì";
           else if (u[i].prenotazione[j].g == 4)
              s+="venerdì";
           else if (u[i].prenotazione[j].g == 5)
              s+="sabato";
           else if (u[i].prenotazione[j].g == 6)
              s+="domenica";

         s+="<br/>";

         s+="<strong>orario</strong>: ";

         if (u[i].prenotazione[j].o == 0)
            s+="19-21";
         else
            s+="21+";

         s+="<br/>";

         s+="<strong>posti</strong>: "+u[i].prenotazione[j].t;

         s+="<br/>";

         temp1=i, temp2=j;

         s+="<button type='submit' class='btn btn-raised btn-success' onclick='cancellaPrenotazione(temp1,temp2);'>Cancella prenotazione</button>";

         s+="<br/><br/>";

      } // for

      } else {

      s+="<a href='index.html'>prenota un posto!</a><br/><br/>";

    } // else

  } // for

  ///////////// fine parte da stampare

  document.getElementById("vistaPrenotazioniUtente").innerHTML = s;

  return true;

}

///////////////////////// CANCELLA PRENOTAZIONE da sistemare

function cancellaPrenotazione(i, j){

  // i è l'utente loggato
  // j è la prenotazione

  // alert("cancellaPrenotazione");

  // alert("i: " + i + " - j: "+j);

  var u = JSON.parse(localStorage.utenti); // vettore degli utenti
  var v = JSON.parse(localStorage.ristoranti); // vettore dei ristoranti

  var nextposu = u.length; // lunghezza vettore degli utenti
  var nextposv = v.length; // lunghezza vettore dei ristoranti

  var a = parseInt(u[i].prenotazione[j].t); // numero posti a sedere prenotati

  // cerco il ristorante del quale voglio cancellare la prenotazione
  for(k=0; k<nextposv; k++){

    if (v[k].id == u[i].prenotazione[j].id) {

      g = u[i].prenotazione[j].g; // giorno prenotazione
      o = u[i].prenotazione[j].o; // orario prenotazione

      alert("numero posti a sedere PRIMA: " + v[k].prenotazione[g].tavolo[o].posti);

      // aggiungo i posti a sedere cancellati
      // v[k].prenotazione[g].tavolo[o].posti = v[k].prenotazione[g].tavolo[o].posti + a;

      alert("numero posti a sedere DOPO: " + v[k].prenotazione[g].tavolo[o].posti);

      // u[i].prenotazione[j] = ''; // creo "" nel localStorage

      alert("localStorage.removeItem(u[i].prenotazione[j]);");
      localStorage.removeItem(u[0].prenotazione[0]);

      // localStorage.SetItem(u[i].prenotazione[j], ''); NON FUNZIONA 

    }

  }

  // salvo ristoranti e utenti nel localStorage
  localStorage.ristoranti = JSON.stringify(v);
  localStorage.utenti = JSON.stringify(u);

  alert("cancellazione prenotazione avvenuta con successo");
    
  location.reload();

  return true;

}

///////////////////////// ESCI ACCOUNT

function esciAccount(){
         
  var u = JSON.parse(localStorage.utenti);
  var nextpos = u.length;

  for (i=0;i<nextpos;i++){

    if (u[i].l==1) {

      u[i].l=0;
      localStorage.utenti = JSON.stringify(u);
      alert("uscita avvenuta con successo");
      window.location.href = "entra.html";
      return true;

    } // if
  } // for

  alert("errore, riprova");
  return false;

}

///////////////////////// CANCELLA ACCOUNT da sistemare

function cancellaAccount(){
         var u = JSON.parse(localStorage.utenti);
         var nextpos = u.length;

         for (i=0;i<nextpos;i++){
            if (u[i].l==1) {
               delete u[i]; // il valore nel vettore diventa "null" e non va bene
               localStorage.utenti = JSON.stringify(u);
               alert("cancellazione account avvenuta con successo");
               return true;
            }  
         }

         alert("errore, riprova");
         return false;
}


   </script>

</head>

<body onload="stampaDatiUtente(); stampaPrenotazioniUtente(); ">

<!-- //////////////// NAVBAR -->

      <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">

        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
         <span class="glyphicon glyphicon-user"></span>
          </button>
          <a class="navbar-brand" href="index.html"> <span class="glyphicon glyphicon-cutlery"></span> The Fork</a>
        </div>

        <div id="navbar" class="navbar-collapse collapse">

        <button onclick="location.href='entra.html';" class="btn btn-raised btn-warning">account</button>

        </div><!--/.navbar-collapse -->       

      </div>
    </nav>

<!-- //////////////// CONTENT -->

<div class="container-fluid">
<h1>Account utente</h1>

<h2>Dati utente</h2>

<div id="vistaDatiUtente"></div>

<h2>Le tue prenotazioni</h2>

<div id="vistaPrenotazioniUtente"></div>

<h2>Avanzate</h2>
<button type='submit' class='btn btn-raised btn-success' onclick="esciAccount();">Esci dall'account</button>
<!-- <input type="button" value="Cancella Account" onclick="cancellaAccount();"> -->

</div>

<!-- 
<div class="container-fluid">
   <hr>

   <input type="button" value="Stampa Storage Tabella" onclick="stampaStorageTabella();">
   <input type="button" value="Reset Storage" onclick="resetStorageUtenti();">

   <div id="vistaStorage"></div>
</div> -->

<!-- //////////////// JAVASCRIPT -->

   <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.js"></script>
   <script>window.jQuery || document.write('<script src="js/vendor/jquery-1.11.2.js"><\/script>')</script>
   <script src="js/vendor/bootstrap.min.js"></script>
   <script src="js/vendor/plugins.js"></script>

</body>

</html>