<!DOCTYPE html>
<html lang="it">
<head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Home | The Fork</title>

  <!-- //////////////// CSS -->

  <link href="https://fonts.googleapis.com/css?family=Slabo+27px" rel="stylesheet">
  <link href="css/bootstrap.css" rel="stylesheet">
  <link href="css/bootstrap-united.css" rel="stylesheet">

  <script src="js/ristoranti.json"></script>
  <script src="js/vendor/modernizr-2.8.3-respond-1.4.2.min.js"></script>

  <style>
    body {
      padding-top: 80px;
    }
    @media (min-width:992px){
      #fissato {
        position: fixed;
      }
      #visibile{
        display: none;
      }
    }
    #sel {
      background-color: yellow;
    }
  </style>

<!-- //////////////// FUNZIONI JS -->

<script type="text/javascript">
  
///////////////////////// INIZIALIZZAZIONE UTENTI

function inizializzaStorageUtenti(){
  if (typeof(localStorage.utenti) == "undefined")
    localStorage.utenti="[]";
}

///////////////////////// PRENOTA RISTORANTE

function prenotaRistorante(i){

  // caricamento dati dal localStorage
  var vristoranti = JSON.parse(localStorage.ristoranti);

  for (j=0; j<vristoranti.length; j++)
    vristoranti[j].p=0; // azzero tutte le prenotazioni

  vristoranti[i].p=1;

  // salvo i dati nel localStorage
  localStorage.ristoranti = JSON.stringify(vristoranti);

  window.location.href = "prenotazione.html";

} // function

///////////////////////// STAMPA NAVBAR

function stampaNavbar(){

  var s = new String("");

  if (typeof(localStorage.utenti) == "undefined") {

    s+="<a class='navbar-brand' href='index.html'> <span class='glyphicon glyphicon-cutlery'></span> The Fork</a><a class='navbar-brand' href='entra.html'><small> <span class='glyphicon glyphicon-user'></span> Account</small></a>";

  } else {

    // caricamento dati dal localStorage
    var vutenti = JSON.parse(localStorage.getItem("utenti"));

    var controllo = 0;

    for(i=0;i<vutenti.length;i++) {
      if(vutenti[i].l==1) {
        s+="<a class='navbar-brand' href='index.html'> <span class='glyphicon glyphicon-cutlery'></span> The Fork</a><a class='navbar-brand' href='entra.html'><small> <span class='glyphicon glyphicon-user'></span> "+vutenti[i].nc+"</small></a>";
        controllo = 1;
      }
    }

    if(controllo==0)
      s+="<a class='navbar-brand' href='index.html'> <span class='glyphicon glyphicon-cutlery'></span> The Fork</a><a class='navbar-brand' href='entra.html'><small> <span class='glyphicon glyphicon-user'></span> Account</small></a>";

  }

  document.getElementById("navbarstampa").innerHTML = s;

}

///////////////////////// STAMPA RISTORANTI

function stampaRistoranti(){

  if (typeof(localStorage.ristoranti) == "undefined") {
    localStorage.setItem("ristoranti", JSON.stringify(ristoranti));  
  }

  // caricamento dati dal localStorage
  var vristoranti = JSON.parse(localStorage.getItem("ristoranti"));

  // variabili che mi serviranno durante la funzione
  var j; // variabile per stampare le stilline
  var s = new String("<h2>Tutti i ristoranti</h2>");

  for (i=0;i<vristoranti.length;i++) {

    s+="<div class='row'> <div class='col-md-12 col-xs-12'>";
    s+="<div class='panel panel-default'><div class='panel-heading'><h3 class='panel-title'><strong>"+vristoranti[i].nome+"</strong></h3></div><div class='panel-body'><div class='row'><div class='col-md-12'><strong>Cucina</strong>: "+vristoranti[i].tipo+"</div><div class='col-md-12'><strong>Luogo</strong>: "+vristoranti[i].luogo+"</div><div class='col-md-12'><strong>Prezzo</strong>: "+vristoranti[i].prezzo+"</div><div class='col-md-12'><strong>Stelle</strong>: ";

    for(j=0;j<vristoranti[i].stelle-1;j++) // stelline piene
      s+="<span class='glyphicon glyphicon-star' aria-hidden='true'></span>";
    for(;j<5;j++) // stelline vuote
      s+="<span class='glyphicon glyphicon-star-empty' aria-hidden='true'></span>";

    s+="</div></div></div><div class='panel-footer'><button type='submit' class='btn btn-success' onclick='prenotaRistorante("+i+")'>Prenota un tavolo <span class='glyphicon glyphicon-calendar'></span></button></div></div>";

    s+="</div></div>";

  } // for

  document.getElementById("ristorante").innerHTML = s;

}

///////////////////////// RICERCA RISTORANTI

function ricercaRistoranti(){

  if (true) {

    // caricamento dati dal localStorage
    var vristoranti = JSON.parse(localStorage.getItem("ristoranti"));

    // variabili che mi serviranno durante la funzione
    var nomeris, luogoris;
    var x,y,controllo=0;
    var s = new String("<h2>Risultati della ricerca:</h2>");

    for (i=0;i<vristoranti.length;i++) {

      if(document.cercaristorante.nomeristorante.value == "")
        nomeris = 0;
      else
        nomeris = document.cercaristorante.nomeristorante.value;
      
      if(document.cercaristorante.luogoristorante.value == "")
        luogoris = 0;
      else
        luogoris = document.cercaristorante.luogoristorante.value;

      if (nomeris!=0)
        x = RegExp('\\b'+ nomeris +'\\b').test( vristoranti[i].nome.toLowerCase() );
      if (luogoris!=0)
        y = RegExp('\\b'+ luogoris +'\\b').test( vristoranti[i].luogo.toLowerCase() );

      // se un utente seleziona solo il nomeris
      if ( x && luogoris==0 ) {

              s+="<div class='row'> <div class='col-md-12 col-xs-12'>";
              s+="<div class='panel panel-default'><div class='panel-heading'><h3 class='panel-title'><strong id='sel'>"+vristoranti[i].nome+"</strong></h3></div><div class='panel-body'><div class='row'><div class='col-md-12'><strong>Cucina</strong>: "+vristoranti[i].tipo+"</div><div class='col-md-12'><strong>Luogo</strong>: "+vristoranti[i].luogo+"</div><div class='col-md-12'><strong>Prezzo</strong>: "+vristoranti[i].prezzo+"</div><div class='col-md-12'><strong>Stelle</strong>: ";

              for(j=0;j<vristoranti[i].stelle-1;j++) // stelline piene
                s+="<span class='glyphicon glyphicon-star' aria-hidden='true'></span>";
              for(;j<5;j++) // stelline vuote
                s+="<span class='glyphicon glyphicon-star-empty' aria-hidden='true'></span>";

              s+="</div></div></div><div class='panel-footer'><button type='submit' class='btn btn-success' onclick='prenotaRistorante("+i+")'>Prenota un tavolo <span class='glyphicon glyphicon-calendar'></span></button></div></div>";

              s+="</div></div>";

              controllo=1;

      } // if

      // se un utente seleziona solo il luogoris
      if ( nomeris==0 && y ) {

              s+="<div class='row'> <div class='col-md-12 col-xs-12'>";
              s+="<div class='panel panel-default'><div class='panel-heading'><h3 class='panel-title'><strong>"+vristoranti[i].nome+"</strong></h3></div><div class='panel-body'><div class='row'><div class='col-md-12'><strong>Cucina</strong>: "+vristoranti[i].tipo+"</div><div class='col-md-12'><strong>Luogo</strong>: <span id='sel'>"+vristoranti[i].luogo+"</span></div><div class='col-md-12'><strong>Prezzo</strong>: "+vristoranti[i].prezzo+"</div><div class='col-md-12'><strong>Stelle</strong>: ";

              for(j=0;j<vristoranti[i].stelle-1;j++) // stelline piene
                s+="<span class='glyphicon glyphicon-star' aria-hidden='true'></span>";
              for(;j<5;j++) // stelline vuote
                s+="<span class='glyphicon glyphicon-star-empty' aria-hidden='true'></span>";

              s+="</div></div></div><div class='panel-footer'><button type='submit' class='btn btn-success' onclick='prenotaRistorante("+i+")'>Prenota un tavolo <span class='glyphicon glyphicon-calendar'></span></button></div></div>";

              s+="</div></div>";

              controllo=1;

      } // if

      // se un utente seleziona nomeris e luogoris
      if ( x && y ) {

              s+="<div class='row'> <div class='col-md-12 col-xs-12'>";
              s+="<div class='panel panel-default'><div class='panel-heading'><h3 class='panel-title'><strong id='sel'>"+vristoranti[i].nome+"</strong></h3></div><div class='panel-body'><div class='row'><div class='col-md-12'><strong>Cucina</strong>: "+vristoranti[i].tipo+"</div><div class='col-md-12'><strong>Luogo</strong>: <span id='sel'>"+vristoranti[i].luogo+"</span></div><div class='col-md-12'><strong>Prezzo</strong>: "+vristoranti[i].prezzo+"</div><div class='col-md-12'><strong>Stelle</strong>: ";

              for(j=0;j<vristoranti[i].stelle-1;j++) // stelline piene
                s+="<span class='glyphicon glyphicon-star' aria-hidden='true'></span>";
              for(;j<5;j++) // stelline vuote
                s+="<span class='glyphicon glyphicon-star-empty' aria-hidden='true'></span>";

              s+="</div></div></div><div class='panel-footer'><button type='submit' class='btn btn-success' onclick='prenotaRistorante("+i+")'>Prenota un tavolo <span class='glyphicon glyphicon-calendar'></span></button></div></div>";

              s+="</div></div>";

              controllo=1;
      } // if

      // ricerca vuota
      if ( nomeris==0 && luogoris==0 ) {

              s+="<div class='row'> <div class='col-md-12 col-xs-12'>";
              s+="<div class='panel panel-default'><div class='panel-heading'><h3 class='panel-title'><strong>"+vristoranti[i].nome+"</strong></h3></div><div class='panel-body'><div class='row'><div class='col-md-12'><strong>Cucina</strong>: "+vristoranti[i].tipo+"</div><div class='col-md-12'><strong>Luogo</strong>: "+vristoranti[i].luogo+"</div><div class='col-md-12'><strong>Prezzo</strong>: "+vristoranti[i].prezzo+"</div><div class='col-md-12'><strong>Stelle</strong>: ";

              for(j=0;j<vristoranti[i].stelle-1;j++) // stelline piene
                s+="<span class='glyphicon glyphicon-star' aria-hidden='true'></span>";
              for(;j<5;j++) // stelline vuote
                s+="<span class='glyphicon glyphicon-star-empty' aria-hidden='true'></span>";

              s+="</div></div></div><div class='panel-footer'><button type='submit' class='btn btn-success' onclick='prenotaRistorante("+i+")'>Prenota un tavolo <span class='glyphicon glyphicon-calendar'></span></button></div></div>";

              s+="</div></div>";

              controllo=1;
      } // if

    } // for

    if (controllo==0) {
      s+="<div class='alert alert-danger'>Nessun risultato trovato :( </div>";
    }

    document.getElementById("ristorante").innerHTML = s;

    window.location.href = "#visibile";

    return false;

  } else {
    return true;
  }

} // function

</script>

</head>
<body onload="inizializzaStorageUtenti(); stampaRistoranti(); stampaNavbar()">

  <!-- //////////////// NAVBAR -->

  <nav class="navbar navbar-inverse navbar-fixed-top">
  <div class="container">
  <div class="container-fluid">

  <div class="navbar-header">
      <div id="navbarstampa"></div>
  </div>

  </div>
  </div>
  </nav>

  <!-- //////////////// CONTENT -->

  <div class="container">
  <div class="row">

  <div class="col-md-6">

  <div id="visibile">
    <form action="#fissato">
      <button type="submit" class="btn  btn-block" class="form-control"><strong><span class="glyphicon glyphicon-search"></span> Ricerca ristorante</strong></button>
    </form>
  </div>

  <div id="ristorante"></div>

  </div> <!-- <div class="col-md-6"> -->

  <div class="col-md-6">

  <!-- //////////// SEARCH start -->

  <div class="panel panel-default" id="fissato">

  <div class="panel-heading">
    <h2><span class="glyphicon glyphicon-search"></span> Ricerca ristorante</h2>
  </div>

  <div class="panel-body">

    <form action="" method="post" name="cercaristorante" onSubmit="return ricercaRistoranti();" accept-charset="utf-8">
      <div class="form-group">
        <label>Nome ristorante</label>
        <input type="text" placeholder="Nome ristorante" name="nomeristorante" value="" class="form-control">
      </div>
      <div class="form-group">
        <label>Luogo ristorante</label>
        <input type="text" placeholder="Luogo ristorante" name="luogoristorante" value="" class="form-control">
      </div>
      <button type="submit" class="btn btn-success btn-block" >Cerca <span class="glyphicon glyphicon-search"></span></button>
    </form>

    <br/>
    <form method="post" name="annulla" onsubmit="return stampaRistoranti();" ><button type='submit' class='btn btn-block btn-danger'>Annulla <span class="glyphicon glyphicon-remove"></span></button></form>        

  </div> <!-- <div class="panel-body"> -->

  </div> <!-- <div class="panel-default"> -->

  <!-- //////////// SEARCH end -->

  </div> <!-- <div class="col-md-6"> -->

  </div> <!-- <div class="row"> -->
  </div> <!-- <div class="container"> -->

<!-- //////////////// JAVASCRIPT -->

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.js"></script>
<script>window.jQuery || document.write('<script src="js/vendor/jquery-1.11.2.js"><\/script>')</script>
<script src="js/vendor/bootstrap.min.js"></script>
<script src="js/vendor/plugins.js"></script>
  
</body>
</html>